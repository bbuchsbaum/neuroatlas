% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cluster_explorer.R
\name{build_cluster_explorer_data}
\alias{build_cluster_explorer_data}
\title{Build Cluster Explorer Data}
\usage{
build_cluster_explorer_data(
  data_source,
  atlas,
  stat_map,
  sample_table = NULL,
  threshold = 3,
  min_cluster_size = 20,
  connectivity = c("26-connect", "18-connect", "6-connect"),
  tail = c("two_sided", "positive", "negative"),
  signal_fun = mean,
  signal_fun_args = list(na.rm = TRUE),
  series_fun = NULL,
  prefetch = TRUE,
  prefetch_max_clusters = Inf,
  prefetch_max_voxels = Inf,
  series_cache_env = NULL
)
}
\arguments{
\item{data_source}{A sample-wise data source supporting
\code{neuroim2::series(data_source, i)} where \code{i} is voxel coordinates
(\code{n x 3} matrix) or indices. Rows of the returned matrix correspond to
samples/design rows.}

\item{atlas}{A volumetric \code{atlas} object used for parcel annotation.
When atlas and \code{stat_map} dimensions differ, the atlas is
automatically resampled to \code{stat_map} space (nearest-neighbor labels)
before cluster annotation.}

\item{stat_map}{A \code{NeuroVol} statistic image used for thresholding and
clustering.}

\item{sample_table}{Optional data frame with one row per sample. If
\code{NULL}, a default table with \code{.sample_index} is created.}

\item{threshold}{Numeric threshold used for cluster formation.}

\item{min_cluster_size}{Minimum number of voxels required to keep a cluster.}

\item{connectivity}{Connectivity passed to \code{neuroim2::conn_comp()}.}

\item{tail}{Clustering mode: \code{"positive"}, \code{"negative"}, or
\code{"two_sided"}.}

\item{signal_fun}{Function used to summarize cluster signal per sample.}

\item{signal_fun_args}{Named list of additional arguments passed to
\code{signal_fun}.}

\item{series_fun}{Optional function override for extracting voxel-wise sample
series. Must accept \code{(data_source, i)} and return a matrix-like object
with one row per sample.}

\item{prefetch}{Logical; if \code{TRUE}, precompute signal summaries for all
clusters on recompute.}

\item{prefetch_max_clusters}{Maximum clusters allowed for eager prefetch.
Prefetch is skipped when exceeded.}

\item{prefetch_max_voxels}{Maximum total cluster voxels allowed for eager
prefetch. Prefetch is skipped when exceeded.}

\item{series_cache_env}{Optional environment used to memoize
voxel-coordinates-to-series extraction across cluster computations.}
}
\value{
A list with:
\describe{
  \item{\code{cluster_table}}{Cluster summary tibble.}
  \item{\code{cluster_parcels}}{Cluster-parcel overlap tibble.}
  \item{\code{cluster_ts}}{Sample-level cluster signal tibble.}
  \item{\code{cluster_voxels}}{Named list of voxel coordinate matrices by
    cluster ID.}
  \item{\code{cluster_index}}{A \code{NeuroVol} of global cluster IDs.}
  \item{\code{sample_table}}{Normalized sample table with
    \code{.sample_index}.}
  \item{\code{prefetch_info}}{List describing whether eager signal prefetch
    was requested/applied and the effective guard thresholds.}
}
}
\description{
Compute sign-aware volumetric connected components from a statistic map,
annotate them with atlas parcels, and extract cluster-level 4D signal
summaries aligned to sample rows.
}
