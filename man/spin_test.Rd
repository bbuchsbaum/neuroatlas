% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/spin_test.R
\name{spin_test}
\alias{spin_test}
\title{Spin Test for Spatial Correlation Significance}
\usage{
spin_test(
  map1,
  map2,
  atlas,
  n_perm = 1000L,
  cor_method = c("pearson", "spearman", "kendall"),
  sphere = NULL,
  seed = NULL
)
}
\arguments{
\item{map1}{Numeric vector of parcel values (length K, aligned to atlas parcels).}

\item{map2}{Numeric vector of parcel values (length K, aligned to atlas parcels).}

\item{atlas}{A surface atlas object (class \code{"surfatlas"}) with
\code{lh_atlas} and \code{rh_atlas} fields, or any atlas whose geometry
can provide sphere coordinates.}

\item{n_perm}{Integer. Number of spin permutations. Default: 1000.}

\item{cor_method}{Character. Correlation method passed to \code{\link[stats]{cor}}.
One of \code{"pearson"}, \code{"spearman"}, or \code{"kendall"}.
Default: \code{"pearson"}.}

\item{sphere}{Optional list with elements \code{lh} and \code{rh}, each an
N x 3 matrix of sphere vertex coordinates. If \code{NULL} (default),
sphere coordinates are fetched via
\code{\link{load_surface_template}(..., "sphere")}.}

\item{seed}{Optional integer seed for reproducibility.}
}
\value{
A list of class \code{"spin_test"} with:
\describe{
  \item{observed}{The observed correlation between \code{map1} and \code{map2}.}
  \item{null_distribution}{Numeric vector of length \code{n_perm} containing
    null correlations.}
  \item{p_value}{Two-sided p-value: proportion of null correlations with
    absolute value >= the observed absolute correlation.}
  \item{n_perm}{Number of permutations performed.}
}
}
\description{
Tests whether the spatial correlation between two parcellated brain maps is
stronger than expected by chance, using the spin-test framework of
Alexander-Bloch et al. (2018). Parcel centroids on a sphere surface are
randomly rotated and reassigned to the nearest original centroid, generating
a null distribution of correlations.
}
\details{
The algorithm:
\enumerate{
  \item Compute parcel centroids on the sphere surface by averaging the
    sphere coordinates of vertices belonging to each parcel.
  \item For each permutation, generate a uniform random 3D rotation matrix
    (from the Haar measure on SO(3)), rotate all centroids, then reassign
    each rotated centroid to its nearest original centroid using
    \code{\link[Rnanoflann]{nn}}.
  \item Compute the correlation of \code{map1} with the permuted
    \code{map2} (values shuffled according to the reassignment).
  \item The p-value is \code{(sum(abs(null) >= abs(observed)) + 1) /
    (n_perm + 1)}.
}
}
\examples{
\dontrun{
atlas <- get_schaefer_surfatlas(parcels = "100", networks = "7")
K <- length(atlas$ids)
map1 <- rnorm(K)
map2 <- map1 + rnorm(K, sd = 0.5)
res  <- spin_test(map1, map2, atlas, n_perm = 500, seed = 42)
print(res)
}

}
\references{
Alexander-Bloch, A. F., et al. (2018). On testing for spatial
correspondence between maps of human brain structure and function.
\emph{NeuroImage}, 178, 540-551.
}
